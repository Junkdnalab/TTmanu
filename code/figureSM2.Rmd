```
{r SM2}


load("../code/survival/survmodel.stansave")


sampsum = summary(samps)
sampsum

asamps = as.array(samps)

r20f = mean(asamps[,,"r20[1]"])
r20m = mean(asamps[,,"r20[2]"])
agrf = mean(asamps[,,"agerate[1]"])
agrm = mean(asamps[,,"agerate[2]"])

#sprintf("r20f mean = %f",r20f)
#sprintf("r20m mean = %f",r20m)
#sprintf("agrf mean = %f", agrf)
#sprintf("agrm mean = %f", agrm)


ourlccdf = function(t,age,agerate,k,r20){
    r20 = r20 * 1e-5
    agerate = agerate*.05
    return(-r20*((365*exp((agerate*k*t)/365+age*agerate-20*agerate))/(agerate*k)
        -(365*exp(age*agerate-20*agerate))/(agerate*k)));
}

ccdfsimpmkr = function(r20,agert){
    function(age){
        exp(ourlccdf(age*365,0,agert,1,r20))
    }
}

mccdf = ccdfsimpmkr(r20m,agrm)
fccdf = ccdfsimpmkr(r20f,agrf)

mortpl <- ggplot(menmort) + 
    geom_line(aes(yrnum,nsurv/100000),col="blue",data=menmort) +
    geom_line(aes(yrnum,nsurv/100000),col="red",data=wommort)+
    stat_function(fun=function(x) mccdf(x),col="green")+
    stat_function(fun=function(x) fccdf(x),col="orange")+labs(title="1-cdf(age) for Men and Women (CDC Data vs  model fit)",x="Age (yrs)",y="1-cdf") +
    theme_minimal()

print(mortpl)


```

