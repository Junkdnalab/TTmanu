---
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r figure-4-plot, fig.width = 9}
umap_cancertype <- data.table::fread("../data/umap_3d_coors.tsv")
kelly.colours <- c("gray95", "gray13", "gold2", "plum4", "darkorange1",
                   "lightskyblue2", "firebrick", "burlywood3", "gray51", "springgreen4",
                   "lightpink2", "deepskyblue4", "lightsalmon2", "mediumpurple4",
                   "orange", "maroon", "yellow3", "brown4", "yellow4", "sienna4", "chocolate", "gray19")
ditto_color <- c(
  "#E69F00", "#56B4E9", "#009E73", "#F0E442",
  "#0072B2", "#D55E00", "#CC79A7", "#666666",
  "#AD7700", "#1C91D4", "#007756", "#D5C711",
  "#005685", "#A04700", "#B14380", "#4D4D4D",
  "#FFBE2D", "#80C7EF", "#00F6B3", "#F4EB71",
  "#06A5FF", "#FF8320", "#D99BBD", "#8C8C8C",
  "#FFCB57", "#9AD2F2", "#2CFFC6", "#F6EF8E",
  "#38B7FF", "#FF9B4D", "#E0AFCA", "#A3A3A3",
  "#8A5F00", "#1674A9", "#005F45", "#AA9F0D",
  "#00446B", "#803800", "#8D3666", "#3D3D3D")
cluster.colours <- c("grey", kelly.colours[c(3:12)])
names(cluster.colours) <- c(0:10)

### A - Cancer Type
par(opar)
par(mfrow = c(2,3), mai = c(0.1, 0.1, 0.1, 0.1))
par(mar = c(2,2,0,0))
I_colors <- c('#fb9a99', '#b15928', '#6a3d9a', 'springgreen4')
names(I_colors) <- c("BRCA", "COAD", "HNSC", "PAAD")
with(umap_cancertype %>% 
       mutate(I_color = case_when(project_code %in% c("COAD", "BRCA", "HNSC", "PAAD") ~ project_code,
                                  TRUE ~ "Other")) %>%
       filter(I_color != "Other"),
     scatter3D(plot_y, -plot_z, plot_x, 
               bg = I_colors[I_color], pch = 21, cex = 0.8, lwd = 0.2,
               theta = 0, phi = 65, scale = F,
               xlab = "", ylab = "UMAP 3", zlab = "UMAP 1",
               colvar = NULL))
legend("top", inset = c(0), legend=rev(names(I_colors[1:2])), col=rev(I_colors[1:2]), pch = 20, bty = "n", horiz = T, cex = 1.2)
legend("top", inset = c(0.10), legend=rev(names(I_colors[3:4])), col=rev(I_colors[3:4]), pch = 20, bty = "n", horiz = T, cex = 1.2)
title(xlab="UMAP 2", line=0)
mtext("A", side=3, line=-2.05, cex=1.2, adj=0)
### B - BRCA subtype
J_colors <- c(ditto_color[c(2,3,4,5)])#, 'grey')
names(J_colors) <- c("Basal", "Her2", "LumA", "LumB")#, "Other")
with(umap_cancertype %>% 
       mutate(J_color = case_when(project_code == "BRCA" ~ Subtype_Selected,
                                  TRUE ~ "Other")) %>%
       filter(J_color != "Other"),
     scatter3D(plot_y, -plot_z, plot_x, 
               bg = J_colors[J_color], pch = 21, cex = 0.8, lwd = 0.2,
               theta = 0, phi = 65, scale = F,
               xlab = "", ylab = "UMAP 3", zlab = "UMAP 1",
               colvar = NULL))
legend("top", inset = c(0), legend=names(J_colors[1:2]), col=J_colors[1:2], pch = 20, bty = "n", horiz = T, cex = 1.2)
legend("top", inset = c(0.10), legend=names(J_colors[3:4]), col=J_colors[3:4], pch = 20, bty = "n", horiz = T, cex = 1.2)
title(xlab="UMAP 2", line=0)
mtext("B", side=3, line=-2.05, cex=1.2, adj=0)
### C - BRCA Somatic Mutations
load("../data/gdc_gene_exp_adj.Rda")
load("../data/gene_data.Rda")
umap_cancertype <- fread("../data/umap_3d_coors.tsv")
brca <- gene_data %>% .[.$external_gene_name %in% c("BRCA1", "BRCA2"),] %>% dplyr::select(ensembl_gene_id, external_gene_name) ## Getting BRCA gene information
brca <- gdc_gene_exp_adj %>% .[rownames(.) %in% brca$ensembl_gene_id, ] %>% ## we only want brca gene
  rownames_to_column(var = "ensembl_gene_id") %>%
  left_join(., brca, by = "ensembl_gene_id") %>% 
  remove_rownames()  %>% column_to_rownames(var = "external_gene_name") %>% ## replace ensembl_id with gene_name
  dplyr::select(-ensembl_gene_id) %>% ## get ride of ensembl_id  col
  t() %>% as.data.frame() %>% ## correct orientation for umap_cancertype df
  rownames_to_column(var = "sample_id") %>% ## getting data ready for leftjoin 
  mutate(BRCA1 = case_when(BRCA1 == "1" ~ "BRCA1",
                           BRCA1 == "0" ~ "NA"),
         BRCA2 = case_when(BRCA2 == "1" ~ "BRCA2",
                           BRCA2 == "0" ~ "NA")) %>%
  mutate(mut_type = gsub('NA,|,NA', '', paste(.$BRCA1, .$BRCA2, sep = ","))) %>% ## combine mutation cause some patients can have both
  dplyr::select(-BRCA1, -BRCA2) %>% ## remove col we don't need
  left_join(., umap_cancertype[,c("sample_id", "plot_x", "plot_y", "plot_z", "project_code")], by = "sample_id") ## leftjoin by sample id

K_colors <- c('#33a02c', '#e31a1c', '#ff7f00')#, "grey")
names(K_colors) <- c("BRCA1", "BRCA1\nBRCA2", "BRCA2")#, "Other")
with(brca %>% filter(mut_type != "NA"),
     scatter3D(plot_y, -plot_z, plot_x, 
               bg = K_colors[mut_type], pch = 21, cex = 0.8, lwd = 0.2,
               theta = 0, phi = 65, scale = F,
               xlab = "", ylab = "UMAP 3", zlab = "UMAP 1",
               colvar = NULL))
legend("top", inset = c(0), legend=names(K_colors[c(1,3)]), col=K_colors[c(1,3)], pch = 20, bty = "n", horiz = T, cex = 1.2)
legend("top", inset = c(0.10), legend="BRCA1,BRCA2", col=K_colors[2], pch = 20, bty = "n", horiz = T, cex = 1.2)
title(xlab="UMAP 2", line=0)
mtext("C", side=3, line=-2.05, cex=1.2, adj=0)
### D - Stage
L_colors <- c('darkgoldenrod3','dodgerblue3','yellow3','tomato2')
names(L_colors) <- c("Stage I", "Stage II", "Stage III", "Stage IV")
with(umap_cancertype %>% filter(ajcc_pathologic_tumor_stage != "Not Available"),
     scatter3D(plot_y, -plot_z, plot_x, 
               bg = L_colors[ajcc_pathologic_tumor_stage], pch = 21, cex = 0.8, lwd = 0.2,
               theta = 0, phi = 65, scale = F,
               xlab = "", ylab = "UMAP 3", zlab = "UMAP 1",
               colvar = NULL))
legend("top", inset = c(0), legend=names(L_colors[1:2]), col=L_colors[1:2], pch = 20, bty = "n", horiz = T, cex = 1.2)
legend("top", inset = c(0.10), legend=names(L_colors[3:4]), col=L_colors[3:4], pch = 20, bty = "n", horiz = T, cex = 1.2)
title(xlab="UMAP 2", line=0)
mtext("D", side=3, line=-2.05, cex=1.2, adj=0)
### E - Metastasis
M_colors <- c('#a6cee3','#1f78b4')
names(M_colors) <- c("M0", "M1")
with(umap_cancertype %>% filter(ajcc_metastasis_pathologic_pm %in% c("M0", "M1")),
     scatter3D(plot_y, -plot_z, plot_x, 
               bg = M_colors[ajcc_metastasis_pathologic_pm], pch = 21, cex = 0.8, lwd = 0.2,
               theta = 0, phi = 65, scale = F,
               xlab = "", ylab = "UMAP 3", zlab = "UMAP 1",
               colvar = NULL))
legend("top", inset = c(0), legend=names(M_colors), col=M_colors, pch = 20, bty = "n", horiz = T, cex = 1.2)
title(xlab="UMAP 2", line=0)
mtext("E", side=3, line=-2.05, cex=1.2, adj=0)

plot.new()
```


